#include <stdio.h>
#include "xparameters.h"
#include "xil_cache.h"
#include "xbasic_types.h"
#include "xbram.h"
#include "bram_header.h"
#include "keypad.h"
#include "lcd.h"

void practica5();
void escribeLineaLCD(char line);

int main() {
	   Xil_ICacheEnable();

	   Xil_DCacheEnable();

	   //INSERTA AQUI LA FUNCIÓN A EJECUTAR
	   practica5();

	   Xil_DCacheDisable();

	   Xil_ICacheDisable();

	   return 0;
}

void practica5(){
	//EN ESTA PRACTICA VAMOS A USAR EL LCD Y EL KEYPAD
	//EL RESULTADO SERÍA SIMULAR EN EL LCD LOS CARTELES QUE UTILIZAN LOS AUTBOUSES PARA INDICAR QUE LINEA SON
	//PARA ELLO EL USUARIO PODRÁ CAMBIAR EL VALOR EN EL LCD PULSANDO UNA DE LAS TECLAS DEL KEYPAD, DONDE CADA UNO DE ESOS VALORES CORRESPONDE A UNA LINEAS (LÍNEAS 0-9 Y A-F)
	//SE MOSTRARÁ ENTONCES LA LÍNEA Y DE DONDE A DONDE VA
	Xuint32 pressedKey, keypadValue;
	char lastLine = 'g', line;

	LCD_inicializa();

	while(1){
		pressedKey = KEYPAD_mReadReg(XPAR_KEYPAD_0_BASEADDR, 0);
		keypadValue = transformKey(pressedKey);
		line = keyToChar(keypadValue);

		if(line != lastLine){//si se indica la misma linea, cambiamos la direccion
			escribeLineaLCD(line);
			lastLine = line;
		}
	}
}
void escribeLineaLCD(char line){
	char* arrival;

	switch(line){
		case '0':
			arrival = "CiU:BCN\0";
			break;
		case '1':
			arrival = "Pio:Cuzco\0";
			break;
		case '2':
			arrival = "BCN:Cuenca\0";
			break;
		case '3':
			arrival = "Sol:Cibeles\0";
			break;
		case '4':
			arrival = "CiU:Sol\0";
			break;
		case '5':
			arrival = "Sol:BCN\0";
			break;
		case '6':
			arrival = "Gran Via:CiU\0";
			break;
		case '7':
			arrival = "Madrid:Cielo\0";
			break;
		case '8':
			arrival = "Murcia:CiU\0";
			break;
		case '9':
			arrival = "Kansas:Mucho\0";
			break;
		case 'A':
			arrival = "Kenia:Cuzco\0";
			break;
		case 'B':
			arrival = "Moncloa:BCN\0";
			break;
		case 'C':
			arrival = "Kenia:BCN\0";
			break;
		case 'D':
			arrival = "Murcia:BCN\0";
			break;
		case 'E':
			arrival = "Marte:BCN\0";
			break;
		case 'F':
			arrival = "CiU:Mi Casa\0";
			break;
		default: break;
	}

	arrival += '0';

	LCD_enviarCMD(CLEAR_DISPLAY_CMD);
	LCD_enviarCMD(RETURN_HOME_CMD);
	LCD_enviarCMD(WRITE_CMD);

	LCD_enviarCMD(WRITE_CMD + 'L');
	LCD_enviarCMD(WRITE_CMD + 'i');
	LCD_enviarCMD(WRITE_CMD + 'n');
	LCD_enviarCMD(WRITE_CMD + 'e');
	LCD_enviarCMD(WRITE_CMD + 'a');
	LCD_enviarCMD(WRITE_CMD + ' ');
	LCD_enviarCMD(WRITE_CMD + line);

	LCD_enviarCMD(SECOND_ROW);

	int i = 0;
	char letra;
	while(arrival[i]!='\0'){
		letra = arrival[i];
		LCD_enviarCMD(WRITE_CMD + letra);
		i++;
	}
}

void envMensaje(char* mensaje){
	int i = 0;
	char letra;
	while(mensaje[i]!='\0'){
		letra = mensaje[i];
		LCD_enviarCMD(WRITE_CMD + letra);
		i++;
	}
}
